# HanQ 배포 — 사용자가 할 일 (명령어 포함)

아래는 **사용자님이 직접 실행할 작업**을 cd 포함한 명령어로 정리한 것입니다.  
프로젝트 경로가 `C:\Users\이창현\Desktop\CH_LMS` 라고 가정합니다. (다르면 경로만 바꿔서 실행하세요.)

---

## 1. exe 빌드하기

### 1-1. 터미널 열기

- **PowerShell** 또는 **Windows 터미널** 실행

### 1-2. 프로젝트 폴더로 이동

```powershell
cd C:\Users\이창현\Desktop\CH_LMS
```

### 1-3. (선택) 가상환경 사용 시 활성화

가상환경을 쓰는 경우에만 실행:

```powershell
.\.venv\Scripts\Activate.ps1
```

(가상환경 안 쓰면 이 단계 생략)

### 1-4. 의존성 설치 (한 번만)

```powershell
pip install -r requirements.txt
```

### 1-5. PyInstaller 설치 (한 번만)

```powershell
pip install pyinstaller
```

### 1-6. 배포용 exe 빌드

**PowerShell**에서 (위 1-2에서 이미 `cd` 한 상태에서):

```powershell
.\scripts\build_exe.ps1
```

**CMD(명령 프롬프트)**에서 쓸 때는 **반드시 두 줄로 나눠서** 실행하세요. (한 줄로 붙이면 "지정된 경로를 찾을 수 없습니다" 오류가 납니다.)

```cmd
cd /d C:\Users\이창현\Desktop\CH_LMS
```

위 한 줄 입력 후 **Enter** → 그다음 아래 한 줄 입력 후 **Enter**:

```cmd
powershell -ExecutionPolicy Bypass -File scripts\build_exe.ps1
```

- 경로에 **백슬래시(`\`)** 가 빠지지 않았는지 확인: `Users\이창현\Desktop\CH_LMS`
- **"Qt plugin directory does not exist"** 오류가 나면: 프로젝트 경로에 한글이 있어서 그렇습니다. `CH_LMS` 폴더 전체를 **한글이 없는 경로**(예: `C:\CH_LMS`)로 복사한 뒤, 그 폴더에서 가상환경 만들고 위 명령을 다시 실행하세요. (자세한 내용은 `docs/데스크톱_exe_빌드_및_배포.md` 2-0 참고.)
- 끝나면 **`dist\HanQ\HanQ.exe`** 가 생성됩니다.
- 실행 파일만 있는 게 아니라 **`dist\HanQ` 폴더 전체**가 배포 패키지입니다.

### 1-7. exe 실행 테스트

```powershell
.\dist\HanQ\HanQ.exe
```

또는 탐색기에서 `C:\Users\이창현\Desktop\CH_LMS\dist\HanQ\HanQ.exe` 더블클릭.

- 로그인 화면이 뜨면 → Heroku 계정으로 로그인 시도 → 메인 화면까지 확인

---

## 2. 배포 패키지 만들어서 전달하기

### 2-1. 압축할 폴더 위치로 이동 (선택)

```powershell
cd C:\Users\이창현\Desktop\CH_LMS\dist
```

### 2-2. 압축

- **탐색기**에서 `C:\Users\이창현\Desktop\CH_LMS\dist\HanQ` **폴더 전체**를 선택
- 우클릭 → **압축(zip)** (또는 "보내기 → 압축(zip) 폴더")
- 생성된 `HanQ.zip` (또는 지정한 이름)을 Google Drive / OneDrive / GitHub Releases 등에 업로드

PowerShell로 압축하려면:

```powershell
cd C:\Users\이창현\Desktop\CH_LMS
Compress-Archive -Path .\dist\HanQ -DestinationPath .\HanQ.zip
```

- `HanQ.zip` 이 프로젝트 루트에 생성됩니다.

### 2-3. 사용자에게 안내

- "HanQ.zip 다운로드 → 압축 해제 → **HanQ.exe** 실행"
- "로그인은 제가 전달한 아이디/비밀번호로 하세요"

---

## 3. 새 사용자 계정 만들기 (로그인 가능하게 하기)

이용할 사람마다 **사용자님이 계정을 한 번 생성**해 주어야 합니다.

### 방법 A: MongoDB Atlas에서 직접 추가

1. 브라우저에서 [MongoDB Atlas](https://cloud.mongodb.com) 로그인
2. **Database** → **Browse Collections**
3. 데이터베이스 **hanq** → 컬렉션 **users** (없으면 Create Database / Create Collection)
4. **Add Document** (Insert Document) 에서 아래 형식으로 입력:

```json
{
  "user_id": "사용할아이디",
  "password": "설정한비밀번호",
  "name": "이름",
  "created_at": "2025-02-03T00:00:00.000Z"
}
```

5. **user_id** 와 **비밀번호**를 해당 사용자에게 전달

### 방법 B: HanQ 앱(관리자)에서 회원 추가

1. 사용자님 PC에서 HanQ를 **admin** 계정으로 로그인
2. **관리** 탭 → **회원 관리** → **회원 추가**
3. 아이디, 비밀번호, 이름 입력 후 저장
4. 해당 **user_id** 와 **비밀번호**를 사용자에게 전달

---

## 4. Heroku 로그인 API 수정 후 다시 배포 (API 쪽만 수정했을 때)

로그인 API(auth_api) 코드만 수정하고 Heroku에 반영할 때:

### 4-1. 프로젝트 루트로 이동

```powershell
cd C:\Users\이창현\Desktop\CH_LMS
```

### 4-2. 변경 사항 커밋 후 GitHub 푸시

```powershell
git add .
git status
git commit -m "로그인 API 수정 내용 요약"
git push origin main
```

- Heroku가 GitHub와 연결되어 있으면 **자동으로 재배포**됩니다.
- 연결이 안 되어 있으면 Heroku 대시보드에서 **Deploy** → **Deploy branch** 로 수동 배포.

---

## 5. Heroku 앱 주소를 바꾼 경우 (exe가 쓰는 주소 변경)

Heroku에서 앱 이름을 바꾸거나 새 앱으로 옮긴 경우, **배포용 exe**가 새 주소를 쓰도록 해야 합니다.

1. **config/config.deploy.json** 열기
2. **login_api.base_url** 을 새 Heroku 주소로 수정  
   예: `"base_url": "https://새앱이름.herokuapp.com"`
3. 저장 후 **exe 다시 빌드** (1-2 ~ 1-6 반복):

```powershell
cd C:\Users\이창현\Desktop\CH_LMS
.\scripts\build_exe.ps1
```

4. 새로 나온 **dist\HanQ** 폴더로 다시 압축해서 배포

---

## 명령어만 빠르게 보기

| 할 일 | 명령어 |
|--------|--------|
| 프로젝트로 이동 | `cd C:\Users\이창현\Desktop\CH_LMS` |
| 의존성 설치 | `pip install -r requirements.txt` |
| PyInstaller 설치 | `pip install pyinstaller` |
| exe 빌드 | `.\scripts\build_exe.ps1` |
| exe 실행 테스트 | `.\dist\HanQ\HanQ.exe` |
| ZIP 압축 (PowerShell) | `Compress-Archive -Path .\dist\HanQ -DestinationPath .\HanQ.zip` |
| GitHub 푸시 (API 수정 후) | `git add .` → `git commit -m "메시지"` → `git push origin main` |
